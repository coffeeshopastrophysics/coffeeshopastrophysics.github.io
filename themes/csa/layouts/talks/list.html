{{ define "main" }}
  {{/* --------- Config / Inputs --------- */}}
  {{/* Expects data/talks.yaml to be a list like:
      - title: "Talk title"
        date: 2025-05-02T15:30:00-05:00   # RFC3339 recommended
        speakers: ["Name (Affiliation)"]
        venue: "Room 170"
        slides: "https://example.com/slides.pdf"
        video: "https://youtu.be/xxxx"
        abstract: "Short summary..."
  */}}

  {{ $talks := .Site.Data.talks }}
  {{ if not $talks }}
  <div class="sm:px-8 mt-32">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <header class="max-w-2xl">
            <h1 class="text-4xl font-bold tracking-tight text-zinc-100 sm:text-5xl">
              CSA Talks
            </h1>
            <p class="mt-6 text-base text-zinc-400">
              No talks data found. Add <code class="text-sm bg-zinc-800 px-1 py-0.5 rounded">data/talks.yaml</code>.
            </p>
          </header>
        </div>
      </div>
    </div>
  </div>
  {{ else }}

  {{/* --------- Prepare lists --------- */}}
  {{ $now := now }}
  {{ $sorted := sort $talks "date" "desc" }}
  {{ $.Scratch.Set "past" (slice) }}
  {{ $.Scratch.Set "upcoming" (slice) }}
  {{ range $sorted }}
    {{ $t := time .date }}
    {{ if lt $t $now }}
      {{ $.Scratch.Add "past" (slice .) }}
    {{ else }}
      {{ $.Scratch.Add "upcoming" (slice .) }}
    {{ end }}
  {{ end }}

  {{ $past := $.Scratch.Get "past" }}
  {{ $upcoming := $.Scratch.Get "upcoming" }}

  {{/* --------- Upcoming Talks Section --------- */}}
  <div class="sm:px-8 mt-32">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <header class="max-w-2xl">
            <h1 class="text-4xl font-bold tracking-tight text-zinc-100 sm:text-5xl">
              Upcoming Talks
            </h1>
          </header>
          <div class="mt-16 sm:mt-20">
            {{ if gt (len $upcoming) 0 }}
            <div class="md:border-l md:border-zinc-700/40 md:pl-6">
              <div class="flex max-w-3xl flex-col space-y-16">
                {{ $.Scratch.Delete "prevDateTime" }}
                {{ range $upcoming }}
                  {{ $talk := . }}
                  {{ $t := time .date }}
                  {{ $currentDateTime := $t.Format "2006-01-02T15:04:05Z07:00" }}
                  {{ $showDate := ne $currentDateTime ($.Scratch.Get "prevDateTime") }}
                  <article class="md:grid md:grid-cols-4 md:items-baseline">
                    <div class="md:col-span-3 group relative flex flex-col items-start">
                      <h2 class="text-2xl font-semibold tracking-tight text-zinc-100">
                        <div class="absolute -inset-x-4 -inset-y-6 z-0 scale-95 bg-zinc-800/50 opacity-0 transition group-hover:scale-100 group-hover:opacity-100 sm:-inset-x-6 sm:rounded-2xl"></div>
                        <span class="relative z-10">
                          {{ with .title }}
                            {{ . }}
                          {{ else }}
                            Untitled talk
                          {{ end }}
                        </span>
                      </h2>
                      <time class="md:hidden relative z-10 order-first mb-3 flex items-center text-base text-zinc-500" datetime="{{ $t }}">
                        {{ if $showDate }}{{ $t.Format "January 2, 2006" }}{{ end }}
                      </time>
                      
                      {{ with .speakers }}
                        <p class="relative z-10 mt-2 text-base text-zinc-400">
                          <span class="font-medium">Speakers:</span> {{ delimit . ", " }}
                        </p>
                      {{ end }}
                      
                      {{ with .venue }}
                        <p class="relative z-10 text-base text-zinc-400">
                          <span class="font-medium">Venue:</span> 
                          {{ if $talk.venue_link }}
                            <a href="{{ $talk.venue_link }}" target="_blank" rel="noopener" class="text-yellow-400 underline hover:text-yellow-300">{{ . }}</a>
                          {{ else }}
                            {{ . }}
                          {{ end }}
                        </p>
                      {{ end }}
                      
                      <p class="relative z-10 text-bsee text-zinc-400">
                        {{ if $showDate }}<span class="font-medium">Date & Time:</span> {{ $t.Format "Monday, January 2, 2006 at 3:04 PM" }}{{ end }}
                      </p>
                      
                      {{ with .abstract }}
                        <p class="relative z-10 mt-2 text-sm text-zinc-400">{{ . }}</p>
                      {{ end }}
                      
                      <div class="relative z-10 mt-4 flex flex-wrap gap-3 text-sm">
                        {{ with .slides }}
                          <a class="text-yellow-400 underline hover:text-yellow-300" href="{{ . }}" target="_blank" rel="noopener">Slides</a>
                        {{ end }}
                        {{ with .video }}
                          <a class="text-yellow-400 underline hover:text-yellow-300" href="{{ . }}" target="_blank" rel="noopener">Video</a>
                        {{ end }}
                      </div>
                    </div>
                    <time class="mt-1 hidden md:block relative z-10 order-first mb-3 flex items-center text-sm text-zinc-500" datetime="{{ $t }}">
                      {{ if $showDate }}{{ $t.Format "January 2, 2006" }}{{ end }}
                    </time>
                  </article>
                  {{ $.Scratch.Set "prevDateTime" $currentDateTime }}
                {{ end }}
              </div>
            </div>
            {{ else }}
            <div class="md:border-l md:border-zinc-700/40 md:pl-6">
              <div class="max-w-3xl">
                <div class="group relative flex flex-col items-start">
                  <div class="relative z-10 p-8 rounded-2xl bg-zinc-800/30 border border-zinc-700/50">
                    <p class="text-lg text-zinc-300 mb-4">
                      No upcoming talks scheduled at the moment.
                    </p>
                    <p class="text-base text-zinc-400">
                      Stay tuned for exciting new talks! Check back soon or follow us for updates on future events.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>

  {{/* --------- Past Talks Section --------- */}}
  {{ if gt (len $past) 0 }}
  <div class="sm:px-8 mt-16 sm:mt-20">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <header class="max-w-2xl">
            <h1 class="text-4xl font-bold tracking-tight text-zinc-100 sm:text-5xl">
              Past Talks
            </h1>
          </header>
          <div class="mt-16 sm:mt-20">
            <div class="md:border-l md:border-zinc-700/40 md:pl-6">
              <div class="flex max-w-3xl flex-col space-y-16">
                {{ $.Scratch.Delete "currentYear" }}
                {{ $.Scratch.Delete "prevPastDateTime" }}
                {{ range $past }}
                  {{ $talk := . }}
                  {{ $t := time .date }}
                  {{ $currentDateTime := $t.Format "2006-01-02T15:04:05Z07:00" }}
                  {{ $showDate := ne $currentDateTime ($.Scratch.Get "prevPastDateTime") }}
                  {{ $year := $t.Format "2006" }}
                  {{ if ne $year ($.Scratch.Get "currentYear") }}
                    {{ if $.Scratch.Get "currentYear" }}
                      <!-- Year separator -->
                    {{ end }}
                    <div class="md:grid md:grid-cols-4 md:items-baseline">
                      <h2 class="text-2xl font-bold tracking-tight text-zinc-100 md:col-span-4">{{ $year }}</h2>
                    </div>
                    {{ $.Scratch.Set "currentYear" $year }}
                  {{ end }}
                  
                  <article class="md:grid md:grid-cols-4 md:items-baseline">
                    <div class="md:col-span-3 group relative flex flex-col items-start">
                      <h3 class="text-2xl font-semibold tracking-tight text-zinc-100">
                        <div class="absolute -inset-x-4 -inset-y-6 z-0 scale-95 bg-zinc-800/50 opacity-0 transition group-hover:scale-100 group-hover:opacity-100 sm:-inset-x-6 sm:rounded-2xl"></div>
                        <span class="relative z-10">
                          {{ with .title }}
                            {{ . }}
                          {{ else }}
                            Untitled talk
                          {{ end }}
                        </span>
                      </h3>
                      <time class="md:hidden relative z-10 order-first mb-3 flex items-center text-sm text-zinc-500" datetime="{{ $t }}">
                        {{ if $showDate }}{{ $t.Format "January 2, 2006" }}{{ end }}
                      </time>
                      
                      {{ with .speakers }}
                        <p class="relative z-10 mt-2 text-base text-zinc-400">
                          <span class="font-medium">Speakers:</span> {{ delimit . ", " }}
                        </p>
                      {{ end }}
                      
                      {{ with .venue }}
                        <p class="relative z-10 text-base text-zinc-400">
                          <span class="font-medium">Venue:</span> 
                          {{ if $talk.venue_link }}
                            <a href="{{ $talk.venue_link }}" target="_blank" rel="noopener" class="text-yellow-400 underline hover:text-yellow-300">{{ . }}</a>
                          {{ else }}
                            {{ . }}
                          {{ end }}
                        </p>
                      {{ end }}
                      
                      <p class="relative z-10 text-base text-zinc-400">
                        {{ if $showDate }}<span class="font-medium">Date & Time:</span> {{ $t.Format "Monday, January 2, 2006 at 3:04 PM" }}{{ end }}
                      </p>
                      
                      {{ with .abstract }}
                        <p class="relative z-10 mt-2 text-sm text-zinc-400">{{ . }}</p>
                      {{ end }}
                      
                      <div class="relative z-10 mt-4 flex flex-wrap gap-3 text-sm">
                        {{ with .slides }}
                          <a class="text-yellow-400 underline hover:text-yellow-300" href="{{ . }}" target="_blank" rel="noopener">Slides</a>
                        {{ end }}
                        {{ with .video }}
                          <a class="text-yellow-400 underline hover:text-yellow-300" href="{{ . }}" target="_blank" rel="noopener">Video</a>
                        {{ end }}
                      </div>
                    </div>
                    <time class="mt-1 hidden md:block relative z-10 order-first mb-3 flex items-center text-sm text-zinc-500" datetime="{{ $t }}">
                      {{ if $showDate }}{{ $t.Format "January 2, 2006" }}{{ end }}
                    </time>
                  </article>
                  {{ $.Scratch.Set "prevPastDateTime" $currentDateTime }}
                {{ end }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {{ end }}

  {{ end }}
{{ end }}